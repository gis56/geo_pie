====================
Конструктор разреза.
====================

Подготовка данных.
------------------

.. _String : https://qgis.org/pyqgis/3.34/core/QgsFieldProxyModel.html#qgis.core.QgsFieldProxyModel.String
.. _Double : https://qgis.org/pyqgis/3.34/core/QgsFieldProxyModel.html#qgis.core.QgsFieldProxyModel.Double
.. _SRTM : https://www.earthdata.nasa.gov/data/instruments/srtm/resources  

Модуль создает макет разреза из объектов карты которые пересекаются линиям разрезов. Для работы модуля необходимо подготовить следующие данные:

* Линии разреза должны быть линейным слоем ``LineGeometry``. Линий в слое может быть несколько. В атрибутах может быть созданно поле с названиями разрезов текстового типа (String_).

* Профили разреза строятся двумя способами.

 1. Построения профиля по изолиниям. Это обязательный вариант.
    Необходимо подготовить линейный слой ``LineGeometry`` с полем значений высот (Double_).
 2. Построение профиля разреза по данным радарного зондирования SRTM_ .
    Для этого необходимо подготовить файл SRTM_ на соответствующую территорию.
    Не является обязательным.

  .. image:: /image/map.jpg
     :alt: Карта
     :height: 300px
     :width: 400px
     :scale: 60 %
     :align: center


* Слой скважин - точечная тема ``PointGeometry``. Слой со скважинами обязательный для построения разрезов.
  На разрез выносятся скважины попавшие в узлы линии разреза.


  .. table:: Атрибутивная таблица должна содержать поля:
     :widths: auto

     +-------------------+------------+-----------------------------------------------+
     | Назначение поля   |    Тип     | Содержание поля                               |
     +===================+============+===============================================+
     | *обязательные поля*                                                            |
     +-------------------+------------+-----------------------------------------------+
     |  Название         | String_    | Название скважины                             |
     +-------------------+------------+-----------------------------------------------+
     | Данные о глубине  | String_    | Глубина скважины ввиде числа или путь к файлу |
     |                   |            | **.csv** с данными для изогнутых скважин      |
     +-------------------+------------+-----------------------------------------------+
     |  Высота устья     | Double_    | Высотя устья скважины                         |
     +-------------------+------------+-----------------------------------------------+
     | *не обязательные поля*                                                         |
     +-------------------+------------+-----------------------------------------------+
     | ГТН               | String_    | Путь к файлу **.csv** с информацией об        |
     |                   |            | интервалах перфорации, литологии и прочем     |
     +-------------------+------------+-----------------------------------------------+


* Произвольное количество линейных ``LineGeometry`` или полигональных ``PolygonGeometry`` слоёв с полями для идентификации объектов пересечений.

.. _altcsv:

* Данные о кривизне для изогнутых скважин 


  .. csv-table:: Примерная таблица данных о кривизне
     :header: "№", "Глубина", "Зенитный угол", "Азимут"
     :widths: auto

     1, 10, "0,17", "0,00"
     2, 20, "0,32", "45,00"
     3, 30, "0,67", "90,00"
     "...", "...", "...", "..."

      
  записать в файл **.csv** таким образом:


  .. code-block:: console

     10;0.17;0
     20;0.32;45
     30;0.67;90
     ...


.. _gtnfield:

* Прочие вертикальные данные.
  Создать файл с расширением **.csv** и записать в него данные об интервалах в таком виде:


  .. code-block:: console

     [filters]
     12;25;lcode#1
     40;53;lcode#2
     ...
     [litology]
     0;37;lcode#3
     37;65;lcode#4
     ...
     ...


  Текст в квадратных скобках будет взят в качестве названия слоя.
  Если для интервалов перфорации название в квадратных скобках будет точно соответствовать ``filters``, то скважины с фильтрами получат другой тип для отображения в атрибутивной таблице. ``True`` в поле ``lcode``.


.. note:: Проект карты должен быть в плоских координатах.


Ввод данных.
------------


В меню **QGis** выбрать пункт :menuselection:`Вектор  --> Мои скрипты --> Конструктор разреза`. Откроется диалоговое окно:

.. list-table::

    * - .. image:: /image/cut_cutdial.png
           :alt: Диалог
           :height: 416px
           :width: 358px
           :align: center
           :scale: 70%
      - .. image:: /image/relf_cutdial.png
           :alt: Диалог
           :height: 416px
           :width: 358px
           :align: center
           :scale: 70%
    * - .. image:: /image/wells_cutdial.png
           :alt: Диалог
           :height: 416px
           :width: 358px
           :align: center
           :scale: 70%
      - .. image:: /image/layer_cutdial.png
           :alt: Диалог
           :height: 416px
           :width: 358px
           :align: center
           :scale: 70%


.. note:: Опции помеченные звездочкой - обязательные.

.. rubric:: Закладка :menuselection:`Разрез`.

В :menuselection:`Слой с линиями разреза` выбрать подготовленный слой с линиями разреза.
Если необходимо построить разрезы не по всем линиям а только по выбранным, нужно предварительно выбрать объекты в слое, а в форме поставить "галочку" в :menuselection:`Только выбранные объекты`.

В :menuselection:`Поле с названиями разрезов` выбрать поле атрибутивной таблицы слоя с именами линий разрезов.
В качестве идентификаторов линий разреза по умолчанию используется ``id`` объекта линии.

Настроить масштаб карты и вертикальный масштаб разреза в выпадающих списках.
Выбор величин масштаба, конечно, не сделает разрез "статичным", но повлияет на значения шкалы и "вытянутость" разреза по вертикали.
Расстояние между делениями шкалы будет соответствовать одному сантиметру только при просмотре получившегося разреза в выбранном *масштабе карты*.

.. rubric:: Закладка :menuselection:`Рельеф`.

В :menuselection:`Слой с изолиниями` выбираем слой с изолиниями, в :menuselection:`Поле с высотами` выбираем поле атрибутивной таблицы изолиний.
В :menuselection:`Слой SRTM`, если имеется, выбираем растр высот.

.. rubric:: Закладка :menuselection:`Скважины`.

Точечный слой скважин выбираем в :menuselection:`Выберите слой скважин` и её название в :menuselection:`Название скважины`.
Выбрать поля атрибутивной таблицы с :ref:`данными о глубине <altcsv>`  в списке :menuselection:`Глубина скважины` и поле с высотой устья в :menuselection:`Абсолютная высотя устья`.

При необходимости определить поле с другими :ref:`вертикальными интервалами <gtnfield>` в списке полей :menuselection:`ГТН`.

.. rubric:: Закладка :menuselection:`Слои`.

Выбранные слои с полями идентификаторов заносятся в список кнопкой |add_img|.
Выбранный слой из списка выбранных можно удалить кнопкой |remove_img|.

.. |add_img| image:: /image/add.png
.. |remove_img| image:: /image/remove.png

Полученые результаты.
---------------------

Построенный макет разреза.

.. image:: /image/cut.jpg
   :alt: Разрез
   :height: 350px
   :width: 460px
   :scale: 60 %
   :align: center


Приблизительная структура слоёв в группах.

.. image:: /image/layers.jpg
   :alt: Разрез
   :height: 410px
   :width: 270px
   :scale: 90 %
   :align: center


..  toctree::

..   cutclass
