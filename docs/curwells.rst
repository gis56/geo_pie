====================
Конструктор разреза.
====================

Подготовка данных.
------------------

.. _String : https://qgis.org/pyqgis/3.34/core/QgsFieldProxyModel.html#qgis.core.QgsFieldProxyModel.String
.. _Double : https://qgis.org/pyqgis/3.34/core/QgsFieldProxyModel.html#qgis.core.QgsFieldProxyModel.Double
.. _SRTM : https://www.earthdata.nasa.gov/data/instruments/srtm/resources  

Модуль создает макет разреза из объектов карты которые пересекаются линиям разрезов. Для работы модуля необходимо подготовить следующие данные:

* Линии разреза должны быть линейным слоем ``LineGeometry``. Линий в слое может быть несколько. В атрибутах может быть созданно поле с названиями разрезов текстового типа (String_).
* Профили разреза строятся двумя способами.

 1. Построения профиля по изолиниям. Это обязательный вариант.
    Необходимо подготовить линейный слой ``LineGeometry`` с полем значений высот (Double_).
 2. Построение профиля разреза по данным радарного зондирования SRTM_ .
    Для этого необходимо подготовить файл SRTM_ на соответствующую территорию.
    Не является обязательным.

  .. image:: /image/map.jpg
     :alt: Карта
     :height: 300px
     :width: 400px
     :scale: 60 %
     :align: center


* Слой скважин - точечная тема ``PointGeometry``. Слой со скважинами обязательный для построения разрезов.
  На разрез выносятся скважины попавшие в узлы линии разреза.

  Атрибутивная таблица должна содержать поля:

  +-------------------+------------+---------------------------------------------------+
  | Назначение поля   |    Тип     | Содержание поля                                   | 
  +===================+============+===================================================+
  | *обязательные поля*                                                                |
  +-------------------+------------+---------------------------------------------------+
  |  Название         | String_    | Название скважины                                 |
  +-------------------+------------+---------------------------------------------------+
  |  Данные о глубине | String_    | | Глубина скважины ввиде числа или путь к файлу   |
  |                   |            | | **.csv** с данными для изогнутых скважин        |
  +-------------------+------------+---------------------------------------------------+
  |  Высота устья     | Double_    | Высотя устья скважины                             |
  +-------------------+------------+---------------------------------------------------+
  | *не обязательные поля*                                                             |
  +-------------------+------------+---------------------------------------------------+
  | ГТН               | String_    | | Путь к файлу **.csv** с информацией об          |
  |                   |            | | интервалах перфорации, литологии и прочем       |
  +-------------------+------------+---------------------------------------------------+

* Произвольное количество линейных ``LineGeometry`` или полигональных ``PolygonGeometry`` слоёв с полями для идентификации объектов пересечений.

* Данные о кривизне для изогнутых скважин

  ========  =========  ===============  ========
  № точки   Глубина    Зенитный угол    Азимут
  ========  =========  ===============  ========
    1         10          0,17            0,00
    2         20          0,32           45,00 
    3         30          0,67           90,00
   ...        ...           ...             ...
  ========  =========  ===============  ========

  записать в файл **.csv** таким образом:

  .. code-block:: console

     10;0.17;0
     20;0.32;45
     30;0.67;90
     ...


* Прочие вертикальные данные.
  Создать файл с расширением **.csv** и записать в него данные об интервалах в таком виде:


  .. code-block:: console

     [filters]
     12;25;lcode#1
     40;53;lcode#2
     ...
     [litology]
     0;37;lcode#3
     37;65;lcode#4
     ...
     ...


  Текст в квадратных скобках будет взят в качестве названия слоя.
  Если для интервалов перфорации название в квадратных скобках будет точно соответствовать ``filters``, то скважины с фильтрами получат другой тип для отображения в атрибутивной таблице. ``True`` в поле ``lcode``.


.. note:: Проект карты должен быть в плоских координатах.


Ввод данных.
------------


В меню **QGis** выбрать пункт :menuselection:`Вектор  --> Мои скрипты --> Конструктор разреза`. Откроется диалоговое окно:

  .. image:: /image/cutdialog.jpg
     :alt: Диалог
     :height: 360px
     :width: 310px
     :align: center


.. note:: Опции помеченные звездочкой - обязательные.

.. rubric:: Закладка :menuselection:`Разрез`.

В :menuselection:`Слой с линиями разреза` выбрать подготовленный слой с линиями разреза.
В :menuselection:`Поле с названиями разрезов` выбрать поле атрибутивной таблицы слоя с именами линий разрезов.
В качестве идентификаторов линий разреза по умолчанию используется ``id`` объекта линии.
Настроить масштаб карты и вертикальный масштаб разреза в выпадающих списках.
Выбор величин масштаба, конечно, не сделает разрез "статичным", но повлияет на значения шкалы и "вытянутость" разреза по вертикали.
Расстояние между делениями шкалы будет соответствовать одному сантиметру только при просмотре получившегося разреза в выбранном *масштабе карты*.

.. rubric:: Закладка :menuselection:`Рельеф`.

В :menuselection:`Слой с изолиниями` выбираем слой с изолиниями, в :menuselection:`Поле с высотами` выбираем поле атрибутивной таблицы изолиний.
В :menuselection:`Слой SRTM`, если имеется, выбираем растр высот.


Полученые результаты.
---------------------

.. image:: /image/cut.jpg
   :alt: Разрез
   :height: 350px
   :width: 460px
   :scale: 60 %
   :align: center


..  toctree::

..   cutclass

